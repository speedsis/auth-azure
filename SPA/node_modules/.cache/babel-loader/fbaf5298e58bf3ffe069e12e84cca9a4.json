{"ast":null,"code":"/*! @azure/msal-browser v2.16.0 2021-07-22 */\n'use strict';\n\nimport { __awaiter, __generator } from '../_virtual/_tslib.js';\nimport { BrowserAuthError } from '../error/BrowserAuthError.js';\nimport { Base64Encode } from '../encode/Base64Encode.js';\n/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\n// Constant byte array length\n\nvar RANDOM_BYTE_ARR_LENGTH = 32;\n/**\r\n * Class which exposes APIs to generate PKCE codes and code verifiers.\r\n */\n\nvar PkceGenerator = function () {\n  function PkceGenerator(cryptoObj) {\n    this.base64Encode = new Base64Encode();\n    this.cryptoObj = cryptoObj;\n  }\n  /**\r\n   * Generates PKCE Codes. See the RFC for more information: https://tools.ietf.org/html/rfc7636\r\n   */\n\n\n  PkceGenerator.prototype.generateCodes = function () {\n    return __awaiter(this, void 0, void 0, function () {\n      var codeVerifier, codeChallenge;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            codeVerifier = this.generateCodeVerifier();\n            return [4\n            /*yield*/\n            , this.generateCodeChallengeFromVerifier(codeVerifier)];\n\n          case 1:\n            codeChallenge = _a.sent();\n            return [2\n            /*return*/\n            , {\n              verifier: codeVerifier,\n              challenge: codeChallenge\n            }];\n        }\n      });\n    });\n  };\n  /**\r\n   * Generates a random 32 byte buffer and returns the base64\r\n   * encoded string to be used as a PKCE Code Verifier\r\n   */\n\n\n  PkceGenerator.prototype.generateCodeVerifier = function () {\n    try {\n      // Generate random values as utf-8\n      var buffer = new Uint8Array(RANDOM_BYTE_ARR_LENGTH);\n      this.cryptoObj.getRandomValues(buffer); // encode verifier as base64\n\n      var pkceCodeVerifierB64 = this.base64Encode.urlEncodeArr(buffer);\n      return pkceCodeVerifierB64;\n    } catch (e) {\n      throw BrowserAuthError.createPkceNotGeneratedError(e);\n    }\n  };\n  /**\r\n   * Creates a base64 encoded PKCE Code Challenge string from the\r\n   * hash created from the PKCE Code Verifier supplied\r\n   */\n\n\n  PkceGenerator.prototype.generateCodeChallengeFromVerifier = function (pkceCodeVerifier) {\n    return __awaiter(this, void 0, void 0, function () {\n      var pkceHashedCodeVerifier, e_1;\n      return __generator(this, function (_a) {\n        switch (_a.label) {\n          case 0:\n            _a.trys.push([0, 2,, 3]);\n\n            return [4\n            /*yield*/\n            , this.cryptoObj.sha256Digest(pkceCodeVerifier)];\n\n          case 1:\n            pkceHashedCodeVerifier = _a.sent(); // encode hash as base64\n\n            return [2\n            /*return*/\n            , this.base64Encode.urlEncodeArr(new Uint8Array(pkceHashedCodeVerifier))];\n\n          case 2:\n            e_1 = _a.sent();\n            throw BrowserAuthError.createPkceNotGeneratedError(e_1);\n\n          case 3:\n            return [2\n            /*return*/\n            ];\n        }\n      });\n    });\n  };\n\n  return PkceGenerator;\n}();\n\nexport { PkceGenerator };","map":{"version":3,"sources":["../../src/crypto/PkceGenerator.ts"],"names":[],"mappings":";;;;;;AAAA;;;;AAUA;;AACA,IAAM,sBAAsB,GAAG,EAA/B;AAEA;;;;;AAQI,WAAA,aAAA,CAAY,SAAZ,EAAoC;AAChC,SAAK,YAAL,GAAoB,IAAI,YAAJ,EAApB;AACA,SAAK,SAAL,GAAiB,SAAjB;AACH;;;;;;AAKK,EAAA,aAAA,CAAA,SAAA,CAAA,aAAA,GAAN,YAAA;;;;;;AACU,YAAA,YAAY,GAAG,KAAK,oBAAL,EAAf;AACgB,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,iCAAL,CAAuC,YAAvC,CAAN,CAAA;;;AAAhB,YAAA,aAAa,GAAG,EAAA,CAAA,IAAA,EAAhB;AACN,mBAAA,CAAA;AAAA;AAAA,cAAO;AACH,cAAA,QAAQ,EAAE,YADP;AAEH,cAAA,SAAS,EAAE;AAFR,aAAP,CAAA;;;;AAIH,GAPK;;;;;;;AAaE,EAAA,aAAA,CAAA,SAAA,CAAA,oBAAA,GAAR,YAAA;AACI,QAAI;;AAEA,UAAM,MAAM,GAAe,IAAI,UAAJ,CAAe,sBAAf,CAA3B;AACA,WAAK,SAAL,CAAe,eAAf,CAA+B,MAA/B,EAHA,C;;AAKA,UAAM,mBAAmB,GAAW,KAAK,YAAL,CAAkB,YAAlB,CAA+B,MAA/B,CAApC;AACA,aAAO,mBAAP;AACH,KAPD,CAOE,OAAO,CAAP,EAAU;AACR,YAAM,gBAAgB,CAAC,2BAAjB,CAA6C,CAA7C,CAAN;AACH;AACJ,GAXO;;;;;;;AAiBM,EAAA,aAAA,CAAA,SAAA,CAAA,iCAAA,GAAd,UAAgD,gBAAhD,EAAwE;;;;;;;;AAGjC,mBAAA,CAAA;AAAA;AAAA,cAAM,KAAK,SAAL,CAAe,YAAf,CAA4B,gBAA5B,CAAN,CAAA;;;AAAzB,YAAA,sBAAsB,GAAG,EAAA,CAAA,IAAA,EAAzB,C;;AAEN,mBAAA,CAAA;AAAA;AAAA,cAAO,KAAK,YAAL,CAAkB,YAAlB,CAA+B,IAAI,UAAJ,CAAe,sBAAf,CAA/B,CAAP,CAAA;;;;AAEA,kBAAM,gBAAgB,CAAC,2BAAjB,CAA6C,GAA7C,CAAN;;;;;;;;;AAEP,GATa;;AAUlB,SAAA,aAAA;AAAC,C","sourcesContent":["/*\r\n * Copyright (c) Microsoft Corporation. All rights reserved.\r\n * Licensed under the MIT License.\r\n */\r\n\r\nimport { PkceCodes } from \"@azure/msal-common\";\r\nimport { BrowserAuthError } from \"../error/BrowserAuthError\";\r\nimport { Base64Encode } from \"../encode/Base64Encode\";\r\nimport { BrowserCrypto } from \"./BrowserCrypto\";\r\n\r\n// Constant byte array length\r\nconst RANDOM_BYTE_ARR_LENGTH = 32;\r\n\r\n/**\r\n * Class which exposes APIs to generate PKCE codes and code verifiers.\r\n */\r\nexport class PkceGenerator {\r\n\r\n    private base64Encode: Base64Encode;\r\n    private cryptoObj: BrowserCrypto;\r\n\r\n    constructor(cryptoObj: BrowserCrypto) {\r\n        this.base64Encode = new Base64Encode();\r\n        this.cryptoObj = cryptoObj;\r\n    }\r\n\r\n    /**\r\n     * Generates PKCE Codes. See the RFC for more information: https://tools.ietf.org/html/rfc7636\r\n     */\r\n    async generateCodes(): Promise<PkceCodes> {\r\n        const codeVerifier = this.generateCodeVerifier();\r\n        const codeChallenge = await this.generateCodeChallengeFromVerifier(codeVerifier);\r\n        return {\r\n            verifier: codeVerifier,\r\n            challenge: codeChallenge\r\n        };\r\n    }\r\n\r\n    /**\r\n     * Generates a random 32 byte buffer and returns the base64\r\n     * encoded string to be used as a PKCE Code Verifier\r\n     */\r\n    private generateCodeVerifier(): string {\r\n        try {\r\n            // Generate random values as utf-8\r\n            const buffer: Uint8Array = new Uint8Array(RANDOM_BYTE_ARR_LENGTH);\r\n            this.cryptoObj.getRandomValues(buffer);\r\n            // encode verifier as base64\r\n            const pkceCodeVerifierB64: string = this.base64Encode.urlEncodeArr(buffer);\r\n            return pkceCodeVerifierB64;\r\n        } catch (e) {\r\n            throw BrowserAuthError.createPkceNotGeneratedError(e);\r\n        }\r\n    }\r\n\r\n    /**\r\n     * Creates a base64 encoded PKCE Code Challenge string from the\r\n     * hash created from the PKCE Code Verifier supplied\r\n     */\r\n    private async generateCodeChallengeFromVerifier(pkceCodeVerifier: string): Promise<string> {\r\n        try {\r\n            // hashed verifier\r\n            const pkceHashedCodeVerifier = await this.cryptoObj.sha256Digest(pkceCodeVerifier);\r\n            // encode hash as base64\r\n            return this.base64Encode.urlEncodeArr(new Uint8Array(pkceHashedCodeVerifier));\r\n        } catch (e) {\r\n            throw BrowserAuthError.createPkceNotGeneratedError(e);\r\n        }\r\n    }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}